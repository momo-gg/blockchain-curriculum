# 5.5 Frontend Frameworks

> *"The best dApp feels like a regular app â€” users shouldn't know there's a blockchain behind it."*

---

## Why This Matters

Building production-ready Solana frontends requires understanding framework-specific patterns, state management strategies, and UX best practices. This module covers how to structure real-world applications using popular frameworks.

---

## ğŸŸ¢ General Understanding

### Framework Landscape

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Frontend Framework Options                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚   REACT ECOSYSTEM                  OTHER FRAMEWORKS                 â”‚
â”‚   â”œâ”€â”€ Next.js (Recommended)        â”œâ”€â”€ Vue + Nuxt                   â”‚
â”‚   â”œâ”€â”€ Create React App             â”œâ”€â”€ Svelte + SvelteKit          â”‚
â”‚   â”œâ”€â”€ Vite + React                 â””â”€â”€ Angular                     â”‚
â”‚   â””â”€â”€ Remix                                                         â”‚
â”‚                                                                      â”‚
â”‚   STATE MANAGEMENT                 STYLING                          â”‚
â”‚   â”œâ”€â”€ React Query                  â”œâ”€â”€ Tailwind CSS                â”‚
â”‚   â”œâ”€â”€ Zustand                      â”œâ”€â”€ styled-components           â”‚
â”‚   â”œâ”€â”€ Jotai                        â””â”€â”€ CSS Modules                 â”‚
â”‚   â””â”€â”€ Redux Toolkit                                                 â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Why Next.js?

| Feature | Benefit for Solana dApps |
|---------|-------------------------|
| Server Components | Fetch data server-side, reduce bundle |
| API Routes | Backend for indexing, auth |
| Static Generation | Fast page loads |
| Image Optimization | NFT galleries |
| Edge Functions | Low-latency RPC proxying |

---

## ğŸŸ¡ PM/EM Depth

### Project Structure

```
my-solana-dapp/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ layout.tsx                # Root layout with providers
â”‚   â”œâ”€â”€ page.tsx                  # Home page
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ [...route]/
â”‚           â””â”€â”€ route.ts          # API routes
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                       # Reusable UI components
â”‚   â”œâ”€â”€ wallet/                   # Wallet-related components
â”‚   â””â”€â”€ features/                 # Feature-specific components
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ solana/                   # Solana utilities
â”‚   â”œâ”€â”€ hooks/                    # Custom hooks
â”‚   â””â”€â”€ utils/                    # General utilities
â”œâ”€â”€ providers/                    # Context providers
â”œâ”€â”€ types/                        # TypeScript types
â”œâ”€â”€ idl/                          # Anchor IDL files
â””â”€â”€ public/                       # Static assets
```

---

## ğŸ”µ Engineer Depth

### Next.js App Router Setup

```tsx
// app/layout.tsx
import { Providers } from "@/providers";

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body>
        <Providers>
          {children}
        </Providers>
      </body>
    </html>
  );
}

// providers/index.tsx
"use client";

import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { WalletContextProvider } from "./WalletProvider";

const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 10 * 1000,
      refetchOnWindowFocus: false,
    },
  },
});

export function Providers({ children }: { children: React.ReactNode }) {
  return (
    <QueryClientProvider client={queryClient}>
      <WalletContextProvider>
        {children}
      </WalletContextProvider>
    </QueryClientProvider>
  );
}
```

### State Management with React Query

```tsx
// lib/hooks/useAccount.ts
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import { useConnection, useWallet } from "@solana/wallet-adapter-react";
import { PublicKey } from "@solana/web3.js";
import { useProgram } from "./useProgram";

// Fetch account data
export function useUserAccount(address: PublicKey | null) {
  const program = useProgram();

  return useQuery({
    queryKey: ["userAccount", address?.toString()],
    queryFn: async () => {
      if (!address || !program) return null;
      return program.account.userAccount.fetch(address);
    },
    enabled: !!address && !!program,
    staleTime: 30_000,
  });
}

// Mutation with optimistic update
export function useDeposit() {
  const program = useProgram();
  const { publicKey } = useWallet();
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: async ({ amount }: { amount: number }) => {
      if (!program || !publicKey) throw new Error("Not connected");

      const [userPda] = PublicKey.findProgramAddressSync(
        [Buffer.from("user"), publicKey.toBuffer()],
        program.programId
      );

      return program.methods
        .deposit(new BN(amount))
        .accounts({ user: publicKey, userAccount: userPda })
        .rpc();
    },
    onMutate: async ({ amount }) => {
      // Cancel outgoing refetches
      await queryClient.cancelQueries({ queryKey: ["userAccount"] });

      // Snapshot previous value
      const previous = queryClient.getQueryData(["userAccount", publicKey?.toString()]);

      // Optimistically update
      queryClient.setQueryData(
        ["userAccount", publicKey?.toString()],
        (old: any) => ({
          ...old,
          balance: (old?.balance || 0) + amount,
        })
      );

      return { previous };
    },
    onError: (err, variables, context) => {
      // Rollback on error
      if (context?.previous) {
        queryClient.setQueryData(
          ["userAccount", publicKey?.toString()],
          context.previous
        );
      }
    },
    onSettled: () => {
      // Always refetch after mutation
      queryClient.invalidateQueries({ queryKey: ["userAccount"] });
    },
  });
}
```

### Component Pattern: Transaction Button

```tsx
// components/TransactionButton.tsx
"use client";

import { useState, useCallback } from "react";
import { useConnection, useWallet } from "@solana/wallet-adapter-react";

type TransactionState = "idle" | "preparing" | "signing" | "confirming" | "success" | "error";

interface TransactionButtonProps {
  onClick: () => Promise<string>;
  children: React.ReactNode;
  onSuccess?: (signature: string) => void;
  onError?: (error: Error) => void;
}

export function TransactionButton({
  onClick,
  children,
  onSuccess,
  onError,
}: TransactionButtonProps) {
  const [state, setState] = useState<TransactionState>("idle");
  const [signature, setSignature] = useState<string | null>(null);
  const { connected } = useWallet();

  const handleClick = useCallback(async () => {
    if (!connected) return;

    try {
      setState("preparing");
      setState("signing");

      const sig = await onClick();
      setSignature(sig);

      setState("confirming");
      // Wait a bit for UI feedback
      await new Promise(r => setTimeout(r, 1000));

      setState("success");
      onSuccess?.(sig);

      // Reset after success
      setTimeout(() => setState("idle"), 2000);
    } catch (error) {
      console.error(error);
      setState("error");
      onError?.(error as Error);

      // Reset after error
      setTimeout(() => setState("idle"), 3000);
    }
  }, [connected, onClick, onSuccess, onError]);

  const buttonText = {
    idle: children,
    preparing: "Preparing...",
    signing: "Sign in wallet...",
    confirming: "Confirming...",
    success: "Success! âœ“",
    error: "Error - Try again",
  }[state];

  return (
    <button
      onClick={handleClick}
      disabled={!connected || state !== "idle"}
      className={`
        px-4 py-2 rounded-lg font-medium transition-all
        ${state === "idle" ? "bg-blue-600 hover:bg-blue-700" : ""}
        ${state === "success" ? "bg-green-600" : ""}
        ${state === "error" ? "bg-red-600" : ""}
        ${state !== "idle" && state !== "success" && state !== "error" ? "bg-gray-600" : ""}
        disabled:opacity-50 disabled:cursor-not-allowed
      `}
    >
      {buttonText}
    </button>
  );
}
```

### Loading and Error States

```tsx
// components/AccountDisplay.tsx
"use client";

import { useUserAccount } from "@/lib/hooks/useAccount";
import { useWallet } from "@solana/wallet-adapter-react";

export function AccountDisplay() {
  const { publicKey } = useWallet();
  const { data, isLoading, error, refetch } = useUserAccount(publicKey);

  if (!publicKey) {
    return (
      <div className="p-4 bg-gray-800 rounded-lg">
        <p className="text-gray-400">Connect wallet to view account</p>
      </div>
    );
  }

  if (isLoading) {
    return (
      <div className="p-4 bg-gray-800 rounded-lg animate-pulse">
        <div className="h-4 bg-gray-700 rounded w-3/4 mb-2"></div>
        <div className="h-4 bg-gray-700 rounded w-1/2"></div>
      </div>
    );
  }

  if (error) {
    return (
      <div className="p-4 bg-red-900/50 rounded-lg">
        <p className="text-red-400">Error loading account</p>
        <button
          onClick={() => refetch()}
          className="mt-2 text-sm underline"
        >
          Retry
        </button>
      </div>
    );
  }

  if (!data) {
    return (
      <div className="p-4 bg-gray-800 rounded-lg">
        <p className="text-gray-400">No account found</p>
        <button className="mt-2 bg-blue-600 px-4 py-2 rounded">
          Create Account
        </button>
      </div>
    );
  }

  return (
    <div className="p-4 bg-gray-800 rounded-lg">
      <h3 className="text-lg font-bold">Your Account</h3>
      <p className="text-gray-400">
        Balance: {(data.balance.toNumber() / 1e9).toFixed(4)} SOL
      </p>
    </div>
  );
}
```

### Server Components for Static Data

```tsx
// app/tokens/page.tsx
// This is a Server Component - no "use client"

import { Connection, PublicKey } from "@solana/web3.js";
import { getMint } from "@solana/spl-token";

async function getTokenInfo(mintAddress: string) {
  const connection = new Connection(process.env.RPC_URL!);
  const mint = await getMint(connection, new PublicKey(mintAddress));

  return {
    supply: mint.supply.toString(),
    decimals: mint.decimals,
    freezeAuthority: mint.freezeAuthority?.toString(),
  };
}

export default async function TokensPage() {
  const tokenInfo = await getTokenInfo("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v");

  return (
    <div className="p-8">
      <h1 className="text-2xl font-bold mb-4">USDC Info</h1>
      <dl>
        <dt className="text-gray-400">Supply</dt>
        <dd className="text-lg">{tokenInfo.supply}</dd>
        <dt className="text-gray-400 mt-2">Decimals</dt>
        <dd className="text-lg">{tokenInfo.decimals}</dd>
      </dl>
    </div>
  );
}
```

### API Route for RPC Proxy

```typescript
// app/api/rpc/route.ts
import { NextRequest, NextResponse } from "next/server";

const ALLOWED_METHODS = [
  "getBalance",
  "getAccountInfo",
  "getLatestBlockhash",
  "sendTransaction",
  "getTransaction",
];

export async function POST(request: NextRequest) {
  const body = await request.json();

  // Validate method
  if (!ALLOWED_METHODS.includes(body.method)) {
    return NextResponse.json(
      { error: "Method not allowed" },
      { status: 403 }
    );
  }

  // Forward to private RPC
  const response = await fetch(process.env.PRIVATE_RPC_URL!, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(body),
  });

  const data = await response.json();

  return NextResponse.json(data);
}
```

### Toast Notifications

```tsx
// components/TransactionToast.tsx
import { toast } from "sonner"; // or your preferred toast library

export function showTransactionToast(signature: string, status: "pending" | "success" | "error") {
  const explorerUrl = `https://explorer.solana.com/tx/${signature}`;

  if (status === "pending") {
    toast.loading("Transaction submitted", {
      description: "Waiting for confirmation...",
      id: signature,
    });
  }

  if (status === "success") {
    toast.success("Transaction confirmed", {
      description: (
        <a href={explorerUrl} target="_blank" className="underline">
          View on Explorer
        </a>
      ),
      id: signature,
    });
  }

  if (status === "error") {
    toast.error("Transaction failed", {
      description: "Please try again",
      id: signature,
    });
  }
}

// Usage
async function handleTransaction() {
  const signature = await sendTransaction();
  showTransactionToast(signature, "pending");

  try {
    await confirmTransaction(signature);
    showTransactionToast(signature, "success");
  } catch {
    showTransactionToast(signature, "error");
  }
}
```

### Mobile Responsive Design

```tsx
// components/MobileWallet.tsx
"use client";

import { useWallet } from "@solana/wallet-adapter-react";
import { useWalletModal } from "@solana/wallet-adapter-react-ui";

export function MobileWalletButton() {
  const { connected, publicKey, disconnect } = useWallet();
  const { setVisible } = useWalletModal();

  if (!connected) {
    return (
      <button
        onClick={() => setVisible(true)}
        className="w-full py-3 bg-purple-600 rounded-lg text-center"
      >
        Connect Wallet
      </button>
    );
  }

  return (
    <div className="flex flex-col gap-2">
      <div className="p-3 bg-gray-800 rounded-lg">
        <p className="text-xs text-gray-400">Connected</p>
        <p className="font-mono text-sm truncate">
          {publicKey?.toString()}
        </p>
      </div>
      <button
        onClick={disconnect}
        className="py-2 bg-gray-700 rounded-lg text-sm"
      >
        Disconnect
      </button>
    </div>
  );
}
```

---

## Common Patterns

### useInterval for Polling

```tsx
import { useEffect, useRef } from "react";

function useInterval(callback: () => void, delay: number | null) {
  const savedCallback = useRef(callback);

  useEffect(() => {
    savedCallback.current = callback;
  }, [callback]);

  useEffect(() => {
    if (delay === null) return;

    const tick = () => savedCallback.current();
    const id = setInterval(tick, delay);

    return () => clearInterval(id);
  }, [delay]);
}

// Usage: Poll for price updates
function PriceDisplay() {
  const [price, setPrice] = useState(0);

  useInterval(() => {
    fetchPrice().then(setPrice);
  }, 5000);

  return <span>${price.toFixed(2)}</span>;
}
```

### Format Utilities

```typescript
// lib/utils/format.ts
import { LAMPORTS_PER_SOL } from "@solana/web3.js";

export function formatSol(lamports: number): string {
  return (lamports / LAMPORTS_PER_SOL).toLocaleString(undefined, {
    minimumFractionDigits: 2,
    maximumFractionDigits: 4,
  });
}

export function shortenAddress(address: string, chars = 4): string {
  return `${address.slice(0, chars)}...${address.slice(-chars)}`;
}

export function formatTimestamp(timestamp: number): string {
  return new Date(timestamp * 1000).toLocaleString();
}
```

---

## Key Takeaways

1. **Use Next.js App Router** â€” best DX for Solana dApps
2. **React Query for data** â€” caching, refetching, optimistic updates
3. **Separate client/server** â€” fetch static data server-side
4. **Handle all states** â€” loading, error, empty, success
5. **Optimistic updates** â€” immediate feedback
6. **Toast notifications** â€” transaction status
7. **Mobile responsive** â€” wallet UX varies on mobile
8. **API routes for RPC** â€” proxy private endpoints

---

## Next

Learn about real-time data and WebSocket subscriptions.

â†’ [5.6 Real-time Data & WebSockets](./5.6-realtime-websockets.md)
